# file: playbook-choco-install-or-upgrade-packages.yml
---
- name: Install or upgrade a list of packages using Chocolatey
  hosts: all
  tasks:
    # Set AC 'Sleep after' setting to 'Never'
    - import_tasks: playbook-powercfg-set-sleep.yml
      vars:
        sleep_after_value: 0

    - name: Bring packages list to latest version state
      win_chocolatey:
        name: "{{ packages }}"
        skip_scripts: "{{ skip_scripts }}"
        package_params: "{{ package_params }}"
        state: latest
      register: result

    # Set AC 'Sleep after' setting to '30 minutes'
    - import_tasks: playbook-powercfg-set-sleep.yml
      vars:
        sleep_after_value: 1800

    - debug:
        var: result